---
title: "Baseline Skills"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(data.table)
library(tidytable)
library(maditr)
library(tidyverse)
library(readxl)
library(ggplot2)
library(stargazer)

mos_skills<-readRDS("~/git/dspg21ari/data/working/mos_skill.Rds") %>% as.data.table()
soc_skills<-readRDS("~/git/dspg21ari/data/working/soc_skill_bls_long.Rds")%>% as.data.table()
skill_uq<-read_csv("~/git/dspg21ari/data/working/skill_network_unique.csv") %>% as.data.table()

#generate tables used for the rest of the document
skills_top<-sort(table(soc_skills$skill), decreasing=TRUE)
skills_top<-skills_top%>% sort(decreasing = TRUE) %>% as.data.table()

# misc
colors <- c("#232d4b","#2c4f6b","#0e879c","#60999a","#d1e0bf","#d9e12b","#e6ce3a","#e6a01d","#e57200","#fdfdfd")

mos_1<-c("Cannon Crewmember", "Cavalry Scout", "Combat Engineer", "Combat Medic Specialist", "Infantryman")
mos_2<-c('Intelligence Analyst', "M1 Armor Crewman", "Military Police", "Unit Supply Specialist", "Wheeled Vehicle Repairer")

```

## R Markdown

# Summary Statistics
```{Summary Statistics, echo=FALSE}
baseline_skills_wage<-all_skills_soc %>% select(socname, tot_emp, a_mean) %>% unique()
baseline_skills_wage<-all_skills_wage[complete.cases(all_skills_wage), ]
baseline_skills_wage[,3]<-sapply(baseline_skills_wage[,3], as.numeric)
stargazer(baseline_skills_wage, summary = TRUE)

```

# stacked bar chart (TBD)

# Baseline Skill Frequency
```{Baseline Skill Frequency, echo=FALSE}
freq_skill<-table(soc_skills$skill) %>% as.data.table()
freq_skill<-freq_skill[order(-N)] %>% top_n.(8)
ggplot(freq_skill, aes(x=reorder(V1, -N), y=N))+geom_bar(stat='identity', fill=colors[1]) +
  labs(x = "Baseline Skill Frequency", y = NULL, title = "Army SOC Code Baseline Skills")+
  scale_x_discrete(labels = str_wrap(freq_skill$V1, width = 10))
```

# Unique Skills (Baseline, Part 1)
Unique: skills that do not occur in all 11 MOS

Most commonly observed: knowledge of languages (Turkish, Urdu, Greek, Thai)
```{r, echo=FALSE}
skill_uq %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_1) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Skill Frequency Weighted by Employment", y = NULL,
       title = "Unique Baseline Skill Frequency (Part 1)")
```

# Part 2
```{Part 2, echo=FALSE}
skill_uq %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_2) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Skill Frequency Weighted by Employment", y = NULL,
       title = "Unique Baseline Skill Frequency (Part 2)")
```

