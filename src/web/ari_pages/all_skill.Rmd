---
title: "All Skills"
output: 
  html_document:
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
root.dir = rprojroot::find_rstudio_root_file()

library(data.table)
library(tidytable)
library(maditr)
library(tidyverse)
library(readxl)
library(ggplot2)
library(stargazer)

all_skills_mos<-read_csv("./data/working/all_skill_mos_network.csv") %>% as.data.table()
all_skills_soc<-readRDS("./data/working/all_soc_skill_bls_long.Rds") %>% as.data.table()
all_skill_uq<-read_csv("./data/working/all_skill_unique.csv")
all_skill<-read_csv("./data/working/all_skill_mos_network.csv")

colors <- c("#232d4b","#2c4f6b","#0e879c","#60999a","#d1e0bf","#d9e12b","#e6ce3a","#e6a01d","#e57200","#fdfdfd")

mos_1<-c("Cannon Crewmember", "Cavalry Scout", "Combat Engineer", "Combat Medic Specialist", "Infantryman")
mos_2<-c('Intelligence Analyst', "M1 Armor Crewman", "Military Police", "Unit Supply Specialist", "Wheeled Vehicle Repairer")

```


###  Exploratory Data Analysis
```{r All Skills Employment Statistics, echo=FALSE}
all_skills_wage<-all_skills_soc %>% select(socname, tot_emp, a_mean) %>% unique()
all_skills_wage<-all_skills_wage[complete.cases(all_skills_wage), ]
all_skills_wage[,3]<-sapply(all_skills_wage[,3], as.numeric)
```

```{r stargaxer, results="asis"}
stargazer(all_skills_wage, summary = TRUE, header = F, type='html')
```

#### All Skills
```{r All Skills Frequency, echo=FALSE}
freq_all_skill<-table(all_skills_mos$skill) %>% as.data.table()
freq_all_skill<-freq_all_skill[order(-N)] %>% top_n(10)
ggplot(freq_all_skill, aes(x=reorder(V1, -N), y=N))+geom_bar(stat='identity', fill=colors[1]) +
  labs(x = "Skill Frequency", y = NULL, title = "Army SOC Code Skills (All) Frequency")+
  scale_x_discrete(labels = str_wrap(freq_all_skill$V1, width = 8))
```
Many of the top skills are also the top baseline skills (communication skills, physical ability, organizational skills, detail-oriented, English), indicating the importance of many of these baseline skills.


#### Specialized Skills
```{r Specialized Skill Frequency, echo=FALSE}
all_skills_mos_specialized<-all_skills_mos %>% filter.(skill_type == "Specialized")
freq_specialized_skill<-all_skills_mos_specialized %>% select(target, freq) %>% as.data.table()
freq_specialized_skill<-freq_specialized_skill[order(-freq)] %>% unique() %>% top_n(10)

ggplot(freq_specialized_skill, aes(x=reorder(target, -freq), y=freq))+geom_bar(stat='identity', fill=colors[1]) +
  labs(x = "Skill Frequency", y = NULL, title = "Army SOC Code Skills (Specialized)")+
  scale_x_discrete(labels = str_wrap(freq_specialized_skill$target, width = 8))
```


```{r, echo=FALSE}
all_skills_mos_specialized %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_2) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Specialized Skill Frequency Weighted by Employment (1)", y = NULL,
       title = "Army SOC Code Skills")

```

```{r, echo=FALSE}
all_skills_mos_specialized %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_1) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Specialized Skill Frequency Weighted by Employment (2)", y = NULL,
       title = "Army SOC Code Skills")
```
The top 5 specialized skills for each MOS are approximately the same once weighted by employment.


####  Software Skills
```{r Specialized Skill Frequency 2, echo=FALSE}
all_skills_mos_software <- all_skills_mos %>% filter.(skill_type=="Software")
freq_software_skill<-all_skills_mos_software %>% select(target, freq) %>% as.data.table()
freq_software_skill<-freq_software_skill[order(-freq)] %>% unique() %>% top_n(10)

ggplot(freq_software_skill, aes(x=reorder(target, -freq), y=freq))+geom_bar(stat='identity', fill=colors[1]) +
  labs(x = "Skill Frequency", y = NULL, title = "Army SOC Code Skills (Software)")+
  scale_x_discrete(labels = str_wrap(freq_software_skill$target, width = 8))
```
SAP is a business software, and combined with the presence of Salesforce and ERP, indicates a demand for software centered around commerce.


```{r, echo=FALSE}
all_skills_mos_software %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_1) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Software Skills Frequency Weighted by Employment (1)", y = NULL,
       title = "Army SOC Code Skills")
```

```{r, echo=FALSE}
all_skills_mos_software %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_2) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Software Skills Frequency Weighted by Employment(2)", y = NULL,
       title = "Army SOC Code Skills")
```
The top 5 software skills are also the same for each MOS, and reflect the top software skills overall.


####  Unique Skills
```{r, echo=FALSE}
all_skill_uq %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_1) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Unique Skill Frequency Weighted by Employment (1)", y = NULL,
       title = "Army SOC Code Skills")
```

```{r, echo=FALSE}
all_skill_uq %>%
  na.omit()%>%
  select(target, source, e_freq) %>%
  filter(source %in% mos_2) %>%
  group_by(target) %>%
  mutate(freq = sum(e_freq)) %>%
  ungroup() %>%
  group_by(source) %>%
  unique()%>%
  slice_max(freq, n = 5) %>%
  ungroup() %>%
  ggplot(aes(freq, fct_reorder(target, freq), fill = source)) +
  scale_fill_manual(values=colors) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~source, ncol = 1, scales = "free") +
  labs(x = "Unique Skill Frequency Weighted by Employment (2)", y = NULL,
       title = "Army SOC Code Skills")
```

Unique skills are defined as skills that aren't seen across all 10 MOS, although the most common unique skills--digital signal processing, game development, cutting in and creative writing are seen across 9 of the 10 MOS.


# Employment by MOS (1)
```{r, echo=FALSE}
all_skill %>%
  na.omit()%>%
  select(target, source, employ) %>%
  filter(source %in% mos_1) %>%
  ggplot(aes(source, employ)) +
  stat_summary(fun=mean, geom="bar", fill=colors[1])+
  labs(x = "MOS", y = NULL,
       title = "Average Employment per MOS (1)")
```

# Employment by MOS (2)
```{r, echo=FALSE}
all_skill %>%
  na.omit()%>%
  select(target, source, employ) %>%
  filter(source %in% mos_2) %>%
  ggplot(aes(source, employ)) +
  stat_summary(fun=mean, geom="bar", fill=colors[1])+
  labs(x = "MOS", y = NULL,
       title = "Average Employment per MOS (2)")
```
Based on BLS data on projected employment for jobs, the average predicted employment for each MOS was taken based on their skills. The highest average employment predicted was for combat medic specialists, intelligence analysts and unit supply specialists while the lowest were for M1 Armor Crewmen and Infantrymen.


# Salary by MOS (1)
```{r, echo=FALSE}
all_skill %>%
  na.omit()%>%
  select(target, source, salary) %>%
  filter(source %in% mos_1) %>%
  ggplot(aes(source, salary)) +
  stat_summary(fun=mean, geom="bar", fill=colors[1])+
  labs(x = "MOS", y = NULL,
       title = "Average Income per MOS (1)")
```


# Salary by MOS (2)
```{r, echo=FALSE}
all_skill %>%
  na.omit()%>%
  select(target, source, salary) %>%
  filter(source %in% mos_2) %>%
  ggplot(aes(source, salary)) +
  stat_summary(fun=mean, geom="bar", fill=colors[1])+
  labs(x = "MOS", y = NULL,
       title = "Average Income per MOS (2)")
```

Based on the salary for each MOS based on their skill, the average salary for jobs acquired by soldiers once leaving the army based on their skills is consistant across MOS.

# Baseline Skill Top 10 Percentages
```{r, echo=FALSE}
all_skills_baseline<-all_skills_mos %>% filter.(isbaseline==TRUE)
all_skills_baseline_top<-all_skills_baseline %>% group_by(`Army MOS Title`, skill) %>%
  summarise(freq=n()) %>% select(`Army MOS Title`, skill, freq) %>% as.data.table() %>% setkey(freq)
all_skills_baseline_top<-all_skills_baseline_top[, tail(.SD, 10), by=`Army MOS Title`]
all_skills_baseline_top<-all_skills_baseline_top %>%
  mutate.(percentage=freq/sum(freq), .by=`Army MOS Title`) %>% ungroup()
ggplot(all_skills_baseline_top, aes(fill=skill, y=freq, x=`Army MOS Title`))+
  geom_bar(position='fill', stat='identity')+
  labs(x="Army MOS", y="Percentage", title="Percentage of Skill in the Top 10 Baseline skills for a MOS")+
  scale_x_discrete(labels=str_wrap(unique(all_skills_baseline_top$`Army MOS Title`), width=10))+
  theme(text=element_text(size=9))
```

# Specialized Skills Top 10 Percentages
```{r, echo=FALSE}
all_skills_specialized_mos<-all_skills_mos %>% filter(isspecialized==TRUE)
all_skills_mos_specialized_top<-all_skills_mos %>% group_by(`Army MOS Title`, skill) %>%
  summarise(freq=n()) %>% select(`Army MOS Title`, skill, freq)
all_skills_mos_specialized_top<-all_skills_mos_specialized_top%>% as.data.table() %>% setkey(freq)
all_skills_mos_specialized_top<-all_skills_mos_specialized_top[, tail(.SD, 10), by=`Army MOS Title`]

all_skills_mos_specialized_top<-all_skills_mos_specialized_top %>%
  mutate.(percentage=freq/sum(freq), .by=`Army MOS Title`) %>% ungroup()
ggplot(all_skills_mos_specialized_top, aes(fill=str_wrap(skill, 10), y=freq, x=`Army MOS Title`))+
  geom_bar(position='fill', stat='identity')+
  labs(x="Army MOS", y="Percentage", title="Percentage of Skill in the Top 10 Specialized skills for a MOS", fill="Skill")+
  scale_x_discrete(labels=str_wrap(unique(all_skills_mos_specialized_top$`Army MOS Title`), width=10))+
  theme(text=element_text(size=9), legend.text=element_text(size=7))
```


# Software Skills Top 10 Percentages
```{r, echo=FALSE}
all_skills_software_mos<-all_skills_mos %>% filter(issoftware==TRUE)
all_skills_mos_software_top<-all_skills_software_mos %>% group_by(`Army MOS Title`, skill) %>%
  summarise(freq=n()) %>% select(`Army MOS Title`, skill, freq) %>% as.data.table() %>% setkey(freq)
all_skills_mos_software_top<-all_skills_mos_software_top[, tail(.SD, 10), by=`Army MOS Title`]

all_skills_mos_software_top<-all_skills_mos_software_top %>%
  mutate.(percentage=freq/sum(freq), .by=`Army MOS Title`) %>% ungroup()
ggplot(all_skills_mos_software_top, aes(fill=str_wrap(skill, 10), y=freq, x=`Army MOS Title`))+
  geom_bar(position='fill', stat='identity')+
  labs(x="Army MOS", y="Percentage", title="Percentage of Skill in the Top 10 Software skills for a MOS", fill="Skill")+
  scale_x_discrete(labels=str_wrap(unique(all_skills_mos_software_top$`Army MOS Title`), width=10))+
  theme(text=element_text(size=9), legend.text=element_text(size=7))
```
The top 10 most popular skills in each MOS include a large proportion of Microsoft related skills (Excel, Word, Windows, etc). Other, more specialized skills such as SQL an AutoCAD only appear among a few MOS top 10 skills, and it could be due to the fact that Microsoft tools are more widely used, while more specialized software skills may not be as widely needed among all.

### Networks
